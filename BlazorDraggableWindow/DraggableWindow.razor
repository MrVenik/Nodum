@implements IDisposable

@code {
    [CascadingParameter]
    public DraggableZone DraggableZone { get; set; }

    [Parameter]
    public RenderFragment WindowHeader { get; set; }

    [Parameter]
    public RenderFragment WindowContent { get; set; }

    [Parameter]
    public double X { get; set; }

    [Parameter]
    public double Y { get; set; }

    public double PositionX { get; set; }
    public double PositionY { get; set; }

    [Parameter]
    public Action<DraggableWindow> OnStartDragingWindow { get; set; }
    [Parameter]
    public Action<DraggableWindow> OnDragingWindow { get; set; }
    [Parameter]
    public Action<DraggableWindow> OnStopDragingWindow { get; set; }
    [Parameter]
    public Action<DraggableWindow> OnDispose { get; set; }

    [Parameter]
    public bool AllowDrag { get; set; }

    public Guid Guid { get; private set; }

    public string WindowId => $"draggablewindow-{Guid}";

    protected override void OnInitialized()
    {
        if (DraggableZone == null) throw new InvalidOperationException("");

        Guid = Guid.NewGuid();

        if (!DraggableZone.DraggableWindows.ContainsKey(WindowId))
        {
            DraggableZone.DraggableWindows.Add(WindowId, this);
        }
    }

    public void Dispose()
    {
        DraggableZone.DraggableWindows.Remove(WindowId);
        OnDispose?.Invoke(this);
    }
}
